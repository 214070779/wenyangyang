---
title: iOSç»„ä»¶åŒ–ç³»åˆ—
categories: 
  - æŠ€æœ¯
  - iOSåŸºç¡€çŸ¥è¯†
tags: 
  - null
date: 2023-08-12 07:33:06
permalink: /pages/f2a247/
---

<!-- [ç»„ä»¶åŒ–å‚è€ƒè¿™ä¸ªæ–‡ç« ](https://mp.weixin.qq.com/s/ABunP34hjPb-c44StYK1dw) -->

# å¸¸â½¤çš„ä¸‰ç§ç»„ä»¶åŒ–é€šè®¯æ–¹æ¡ˆ
ç»„ä»¶åŒ–é€šä¿¡æ–¹æ¡ˆ
ç»„ä»¶åŒ–æœ€é‡è¦çš„æ˜¯å…„å¼Ÿæ¨¡å—çš„é€šè®¯
å¸¸â½¤çš„ä¸‰ç§æ–¹æ¡ˆ
- URL Scheme
- Target - Action
- Protocol - Class åŒ¹é…

## URL Schemeè·¯ç”±
- ä½¿ URL å¤„ç†æœ¬åœ°çš„è·³è½¬
- é€šè¿‡ä¸­é—´å±‚è¿›â¾æ³¨å†Œ & è°ƒâ½¤ ï¼ˆloadæ–¹æ³•é‡ŒæŠŠè¢«è°ƒç”¨è€…æ³¨å†Œåˆ°ä¸­é—´å±‚ï¼‰
- æ³¨å†Œè¡¨â½†éœ€ä½¿ç”¨åå°„
- éæ‡’åŠ è½½ / æ³¨å†Œè¡¨çš„ç»´æŠ¤ / å‚æ•°

::: details
``` js
//MTMediator.h --- start
typedef void(^MTMediatorProcessBlock)(NSDictionary *params);

+ (void)registerScheme:(NSString *)scheme processBlock:(MTMediatorProcessBlock)processBlock;

+ (void)openUrl:(NSString *)url params:(NSDictionary *)params;
//MTMediator.h --- end

//MTMediator.m --- start
+ (NSMutableDictionary *)mediatorCache{
Â  Â  static NSMutableDictionary *cacheScheme;
Â  Â  static dispatch_once_t onceToken;
Â  Â  dispatch_once(&onceToken, ^{
Â  Â  Â  Â  cacheScheme = @{}.mutableCopy;
Â  Â  });

Â  Â  return cacheScheme;
}

+ (void)registerScheme:(NSString *)scheme processBlock:(MTMediatorProcessBlock)processBlock{
Â  Â  if (scheme.length > 0 && processBlock) {
Â  Â  Â  Â  [[[self class] mediatorCache] setObject:processBlock forKey:scheme];
Â  Â  }
}

+ (void)openUrl:(NSString *)url params:(NSDictionary *)params{
Â  Â  MTMediatorProcessBlock block = [[[self class] mediatorCache] objectForKey:url];
Â  Â  if (block) {
Â  Â  Â  Â  block(params);
Â  Â  }
}
//MTMediator.m --- end

//æ³¨å†Œ --- start
+ (void)load {
Â  Â  [MTMediator registerScheme:@"detail://" processBlock:^(NSDictionary * _Nonnull params) {
Â  Â  Â  Â  NSString *url = (NSString *)[params objectForKey:@"url"];
Â  Â  Â  Â  UINavigationController *navigationController = (UINavigationController *)[params objectForKey:@"controller"];
Â  Â  Â  Â  MTDetailViewController *controller = [[MTDetailViewController alloc] initWithUrlString:url];
//Â  Â  Â  Â  controller.title = [NSString stringWithFormat:@"%@", @(indexPath.row)];
Â  Â  Â  Â  [navigationController pushViewController:controller animated:YES];
Â  Â  }];
}
//æ³¨å†Œ --- end

//è°ƒç”¨ --- start
//URL Scheme
[MTMediator openUrl:@"detail://" params:@{@"url":item.articleUrl,@"controller":self.navigationController}];
//è°ƒç”¨ --- end

```
:::

::: tip
è¯´æ˜ï¼š

å‚è€ƒäº†ç³»ç»ŸURL Schemeæœºåˆ¶
å‚æ•°ä¼ é€’é€šè¿‡dictionaryï¼Œå¯¹è°ƒç”¨è€…ä¸é€æ˜
:::
ç›®å‰iOSä¸Šå¤§éƒ¨åˆ†è·¯ç”±å·¥å…·éƒ½æ˜¯åŸºäºURLåŒ¹é…çš„ï¼Œæˆ–è€…æ˜¯æ ¹æ®å‘½åçº¦å®šï¼Œç”¨runtimeæ–¹æ³•è¿›è¡ŒåŠ¨æ€è°ƒç”¨

è¿™äº›åŠ¨æ€åŒ–çš„æ–¹æ¡ˆçš„ä¼˜ç‚¹æ˜¯å®ç°ç®€å•ï¼Œç¼ºç‚¹æ˜¯éœ€è¦ç»´æŠ¤å­—ç¬¦ä¸²è¡¨ï¼Œæˆ–è€…ä¾èµ–äºå‘½åçº¦å®šï¼Œæ— æ³•åœ¨ç¼–è¯‘æ—¶æš´éœ²å‡ºæ‰€æœ‰é—®é¢˜ï¼Œéœ€è¦åœ¨è¿è¡Œæ—¶æ‰èƒ½å‘ç°é”™è¯¯ã€‚

### MGJRouter
URLè·¯ç”±æ–¹å¼ä¸»è¦æ˜¯ä»¥è˜‘è‡è¡—ä¸ºä»£è¡¨çš„çš„
[MGJRouter-swift](https://github.com/821385843/MGJRouter_Swift.git)
[MGJRoute-oc](https://github.com/lyujunwei/MGJRouter.git)
å…¶å®ç°æ€è·¯æ˜¯ï¼š

Appå¯åŠ¨æ—¶å®ä¾‹åŒ–å„ç»„ä»¶æ¨¡å—ï¼Œç„¶åè¿™äº›ç»„ä»¶å‘ModuleManageræ³¨å†ŒUrlï¼Œæœ‰äº›æ—¶å€™ä¸éœ€è¦å®ä¾‹åŒ–ï¼Œä½¿ç”¨classæ³¨å†Œ
å½“ç»„ä»¶Aéœ€è¦è°ƒç”¨ç»„ä»¶Bæ—¶ï¼Œå‘ModuleManagerä¼ é€’URLï¼Œå‚æ•°è·ŸéšURLä»¥GETæ–¹å¼ä¼ é€’ï¼Œç±»ä¼¼openURLã€‚ç„¶åç”±ModuleManagerè´Ÿè´£è°ƒåº¦ç»„ä»¶Bï¼Œæœ€åå®Œæˆä»»åŠ¡ã€‚
```
// 1ã€æ³¨å†ŒæŸä¸ªURL
MGJRouter.registerURLPattern("app://home") { (info) in
    print("info: (info)")
}

//2ã€è°ƒç”¨è·¯ç”±
MGJRouter.openURL("app://home")

```
#### URL è·¯ç”±çš„ä¼˜ç‚¹

- æé«˜çš„åŠ¨æ€æ€§ï¼Œé€‚åˆç»å¸¸å¼€å±•è¿è¥æ´»åŠ¨çš„appï¼Œä¾‹å¦‚ç”µå•†
- æ–¹ä¾¿åœ°ç»Ÿä¸€ç®¡ç†å¤šå¹³å°çš„è·¯ç”±è§„åˆ™
- æ˜“äºé€‚é…URL Scheme

#### URl è·¯ç”±çš„ç¼ºç‚¹

- ä¼ å‚æ–¹å¼æœ‰é™ï¼Œå¹¶ä¸”æ— æ³•åˆ©ç”¨ç¼–è¯‘å™¨è¿›è¡Œå‚æ•°ç±»å‹æ£€æŸ¥ï¼Œå› æ­¤æ‰€æœ‰çš„å‚æ•°éƒ½æ˜¯é€šè¿‡å­—ç¬¦ä¸²è½¬æ¢è€Œæ¥
- åªé€‚ç”¨äºç•Œé¢æ¨¡å—ï¼Œä¸é€‚ç”¨äºé€šç”¨æ¨¡å—
- å‚æ•°çš„æ ¼å¼ä¸æ˜ç¡®ï¼Œæ˜¯ä¸ªçµæ´»çš„ dictionaryï¼Œä¹Ÿéœ€è¦æœ‰ä¸ªåœ°æ–¹å¯ä»¥æŸ¥å‚æ•°æ ¼å¼ã€‚
- ä¸æ”¯æŒstoryboard
- ä¾èµ–äºå­—ç¬¦ä¸²ç¡¬ç¼–ç ï¼Œéš¾ä»¥ç®¡ç†ï¼Œè˜‘è‡è¡—åšäº†ä¸ªåå°ä¸“é—¨ç®¡ç†ã€‚
- æ— æ³•ä¿è¯æ‰€ä½¿ç”¨çš„çš„æ¨¡å—ä¸€å®šå­˜åœ¨
- è§£è€¦èƒ½åŠ›æœ‰é™ï¼Œurl çš„â€æ³¨å†Œâ€ã€â€å®ç°â€ã€â€ä½¿ç”¨â€å¿…é¡»ç”¨ç›¸åŒçš„å­—ç¬¦è§„åˆ™ï¼Œä¸€æ—¦ä»»ä½•ä¸€æ–¹åšå‡ºä¿®æ”¹éƒ½ä¼šå¯¼è‡´å…¶ä»–æ–¹çš„ä»£ç å¤±æ•ˆï¼Œå¹¶ä¸”é‡æ„éš¾åº¦å¤§




## Target - Action 

- æŠ½ç¦»ä¸šåŠ¡é€»è¾‘
- é€šè¿‡ä¸­é—´å±‚è¿›è¡Œè°ƒâ½¤
- ä¸­é—´å±‚ä½¿â½¤ runtime åå°„ 
- ä¸­é—´å±‚ä»£ç ä¼˜åŒ–
::: details
```js
//MTMediator.h
#import <UIKit/UIKit.h>
#import <Foundation/Foundation.h>

NS_ASSUME_NONNULL_BEGIN

@interface MTMediator : NSObject

//target action
+ ( __kindof UIViewController *)detailViewControllerWithUrl:(NSString *)detailUrl;

@end

NS_ASSUME_NONNULL_END

//MTMediator.m
#import "MTMediator.h"

@implementation MTMediator

+ ( __kindof UIViewController *)detailViewControllerWithUrl:(NSString *)detailUrl{
Â  Â  Class detailVC = NSClassFromString(@"MTDetailViewController");
Â  Â  UIViewController *controller = [[detailVC alloc] performSelector:NSSelectorFromString(@"initWithUrlString:") withObject:detailUrl];

    return controller;
}

@end

//è°ƒç”¨ 
//Target - Action
 UIViewController *vc = [MTMediator detailViewControllerWithUrl:item.articleUrl];
 vc.title = @"è¯¦æƒ…å•Š";
 [self.navigationController pushViewController:vc animated:YES];
 
è¯´æ˜ï¼š

ç¡¬ç¼–ç æ–¹å¼ï¼ˆç›´æ¥è°ƒç”¨ï¼Œä¸åˆ©äºç»´æŠ¤å’Œæ‰©å±•ï¼‰
perform æœ€å¤šèƒ½ä¼ é€’2ä¸ªå‚æ•°ï¼Œå¯ä»¥ä¼ å…¥å­—å…¸é¿å…å‚æ•°è¿‡å¤š 
- (id)performSelector:(SEL)aSelector withObject:(id)object1 withObject:(id)object2; 
initWithUrlString:æ–¹æ³•å¿…é¡»å®ç° å¦åˆ™æ‰¾ä¸åˆ°selå´©æºƒ
ä¸šåŠ¡é€»è¾‘æŸ”åˆåœ¨Mediatorä¸­ï¼Œå¯ä»¥å„ä¸ªæ¨¡å—å†™å„è‡ªçš„MTMediatoræ‰©å±•


```
:::

### CTMediator
ä¸‰æ–¹æ¡†æ¶å…¶ä¸»è¦çš„ä»£è¡¨æ¡†æ¶æ˜¯casatwyçš„[CTMediator](https://github.com/casatwy/CTMediator.git)
è¿™ä¸ªæ–¹æ¡ˆæ˜¯åŸºäºOCçš„runtimeã€categoryç‰¹æ€§åŠ¨æ€è·å–æ¨¡å—ï¼Œä¾‹å¦‚é€šè¿‡NSClassFromStringè·å–ç±»å¹¶åˆ›å»ºå®ä¾‹ï¼Œé€šè¿‡performSelector + NSInvocationåŠ¨æ€è°ƒç”¨æ–¹æ³•

å…¶å®ç°æ€è·¯æ˜¯ï¼š

1. åˆ©ç”¨åˆ†ç±»ä¸ºè·¯ç”±æ·»åŠ æ–°æ¥å£ï¼Œåœ¨æ¥å£ä¸­é€šè¿‡å­—ç¬¦ä¸²è·å–å¯¹åº”çš„ç±»
2. é€šè¿‡runtimeåˆ›å»ºå®ä¾‹ï¼ŒåŠ¨æ€è°ƒç”¨å®ä¾‹çš„æ–¹æ³•

CTMediatorç®€å•ä½¿ç”¨ï¼š
::: details
```swift
//******* 1ã€åˆ†ç±»å®šä¹‰æ–°æ¥å£
extension CTMediator{
    @objc func A_showHome()->UIViewController?{
    
        //åœ¨swiftä¸­ä½¿ç”¨æ—¶ï¼Œéœ€è¦ä¼ å…¥å¯¹åº”é¡¹ç›®çš„targetåç§°ï¼Œå¦åˆ™ä¼šæ‰¾ä¸åˆ°è§†å›¾æ§åˆ¶å™¨
        let params = [
            kCTMediatorParamsKeySwiftTargetModuleName: "CJLBase_Example"
        ]
        //CTMediatoræä¾›çš„performTarget:action:params:shouldCacheTarget:æ–¹æ³• é€šè¿‡ä¼ å…¥nameï¼Œæ‰¾åˆ°å¯¹åº”çš„targerå’Œaction
        if let vc = self.performTarget("A", action: "Extension_HomeViewController", params: params, shouldCacheTarget: false) as? UIViewController{
            return vc
        }
        return nil
    }
}

//******* 2ã€æ¨¡å—æä¾›è€…æä¾›target-actionçš„è°ƒç”¨æ–¹å¼ï¼ˆå¯¹å¤–éœ€è¦åŠ ä¸Špublicå…³é”®å­—ï¼‰
class Target_A: NSObject {
    
    @objc func Action_Extension_HomeViewController(_ params: [String: Any])->UIViewController{
         
        let home = HomeViewController()
        return home
    }

}

//******* 3ã€ä½¿ç”¨
if let vc = CTMediator.sharedInstance().A_showHome() {
            self.navigationController?.pushViewController(vc, animated: true)
        }

```
:::

å…¶æ¨¡å—é—´çš„å¼•ç”¨å…³ç³»å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š

![Screenshot-2023-08-27-at-08](https://cdn.staticaly.com/gh/214070779/picx-images-hosting@master/20230813/Screenshot-2023-08-27-at-08.49.42.4fdiiebab440.webp)

#### ä¼˜ç‚¹

- åˆ©ç”¨ åˆ†ç±» å¯ä»¥æ˜ç¡®å£°æ˜æ¥å£ï¼Œè¿›è¡Œç¼–è¯‘æ£€æŸ¥
- å®ç°æ–¹å¼è½»é‡

#### ç¼ºç‚¹

- éœ€è¦åœ¨mediator å’Œ targetä¸­é‡æ–°æ·»åŠ æ¯ä¸€ä¸ªæ¥å£ï¼Œæ¨¡å—åŒ–æ—¶ä»£ç è¾ƒä¸ºç¹ç
- åœ¨ category ä¸­ä»ç„¶å¼•å…¥äº†å­—ç¬¦ä¸²ç¡¬ç¼–ç ï¼Œå†…éƒ¨ä½¿ç”¨å­—å…¸ä¼ å‚ï¼Œä¸€å®šç¨‹åº¦ä¸Šä¹Ÿå­˜åœ¨å’Œ URL è·¯ç”±ç›¸åŒçš„é—®é¢˜
- æ— æ³•ä¿è¯ä½¿ç”¨çš„æ¨¡å—ä¸€å®šå­˜åœ¨ï¼Œtargetåœ¨ä¿®æ”¹åï¼Œä½¿ç”¨è€…åªèƒ½åœ¨è¿è¡Œæ—¶æ‰èƒ½å‘ç°é”™è¯¯
- å¯èƒ½ä¼šåˆ›å»ºè¿‡å¤šçš„ target ç±»

#### CTMediatoræºç åˆ†æ

é€šè¿‡ä¸Šé¢CTMediatorç®€å•ç¤ºä¾‹çš„åˆ†ç±»æ‰€è°ƒç”¨çš„performTargetæ¥åˆ°CTMediatorä¸­çš„å…·ä½“å®ç°ï¼Œå³performTarget:action:params:shouldCacheTarget:ï¼Œä¸»è¦æ˜¯é€šè¿‡ä¼ å…¥çš„nameï¼Œæ‰¾åˆ°å¯¹åº”çš„target å’Œ action
::: details
```swift
- (id)performTarget:(NSString *)targetName action:(NSString *)actionName params:(NSDictionary *)params shouldCacheTarget:(BOOL)shouldCacheTarget
{
    if (targetName == nil || actionName == nil) {
        return nil;
    }
    //åœ¨swiftä¸­ä½¿ç”¨æ—¶ï¼Œéœ€è¦ä¼ å…¥å¯¹åº”é¡¹ç›®çš„targetåç§°ï¼Œå¦åˆ™ä¼šæ‰¾ä¸åˆ°è§†å›¾æ§åˆ¶å™¨
    NSString *swiftModuleName = params[kCTMediatorParamsKeySwiftTargetModuleName];
    
    // generate target ç”Ÿæˆtarget
    NSString *targetClassString = nil;
    if (swiftModuleName.length > 0) {
        //swiftä¸­targetæ–‡ä»¶åæ‹¼æ¥
        targetClassString = [NSString stringWithFormat:@"%@.Target_%@", swiftModuleName, targetName];
    } else {
        //OCä¸­targetæ–‡ä»¶åæ‹¼æ¥
        targetClassString = [NSString stringWithFormat:@"Target_%@", targetName];
    }
    //ç¼“å­˜ä¸­æŸ¥æ‰¾target
    NSObject *target = [self safeFetchCachedTarget:targetClassString];
    //ç¼“å­˜ä¸­æ²¡æœ‰target
    if (target == nil) {
        //é€šè¿‡å­—ç¬¦ä¸²è·å–å¯¹åº”çš„ç±»
        Class targetClass = NSClassFromString(targetClassString);
        //åˆ›å»ºå®ä¾‹
        target = [[targetClass alloc] init];
    }

    // generate action ç”Ÿæˆactionæ–¹æ³•åç§°
    NSString *actionString = [NSString stringWithFormat:@"Action_%@:", actionName];
    //é€šè¿‡æ–¹æ³•åå­—ç¬¦ä¸²è·å–å¯¹åº”çš„sel
    SEL action = NSSelectorFromString(actionString);
    
    if (target == nil) {
        // è¿™é‡Œæ˜¯å¤„ç†æ— å“åº”è¯·æ±‚çš„åœ°æ–¹ä¹‹ä¸€ï¼Œè¿™ä¸ªdemoåšå¾—æ¯”è¾ƒç®€å•ï¼Œå¦‚æœæ²¡æœ‰å¯ä»¥å“åº”çš„targetï¼Œå°±ç›´æ¥returnäº†ã€‚å®é™…å¼€å‘è¿‡ç¨‹ä¸­æ˜¯å¯ä»¥äº‹å…ˆç»™ä¸€ä¸ªå›ºå®šçš„targetä¸“é—¨ç”¨äºåœ¨è¿™ä¸ªæ—¶å€™é¡¶ä¸Šï¼Œç„¶åå¤„ç†è¿™ç§è¯·æ±‚çš„
        [self NoTargetActionResponseWithTargetString:targetClassString selectorString:actionString originParams:params];
        return nil;
    }
    //æ˜¯å¦éœ€è¦ç¼“å­˜
    if (shouldCacheTarget) {
        [self safeSetCachedTarget:target key:targetClassString];
    }
    //æ˜¯å¦å“åº”sel
    if ([target respondsToSelector:action]) {
        //åŠ¨æ€è°ƒç”¨æ–¹æ³•
        return [self safePerformAction:action target:target params:params];
    } else {
        // è¿™é‡Œæ˜¯å¤„ç†æ— å“åº”è¯·æ±‚çš„åœ°æ–¹ï¼Œå¦‚æœæ— å“åº”ï¼Œåˆ™å°è¯•è°ƒç”¨å¯¹åº”targetçš„notFoundæ–¹æ³•ç»Ÿä¸€å¤„ç†
        SEL action = NSSelectorFromString(@"notFound:");
        if ([target respondsToSelector:action]) {
            return [self safePerformAction:action target:target params:params];
        } else {
            // è¿™é‡Œä¹Ÿæ˜¯å¤„ç†æ— å“åº”è¯·æ±‚çš„åœ°æ–¹ï¼Œåœ¨notFoundéƒ½æ²¡æœ‰çš„æ—¶å€™ï¼Œè¿™ä¸ªdemoæ˜¯ç›´æ¥returnäº†ã€‚å®é™…å¼€å‘è¿‡ç¨‹ä¸­ï¼Œå¯ä»¥ç”¨å‰é¢æåˆ°çš„å›ºå®šçš„targeté¡¶ä¸Šçš„ã€‚
            [self NoTargetActionResponseWithTargetString:targetClassString selectorString:actionString originParams:params];
            @synchronized (self) {
                [self.cachedTarget removeObjectForKey:targetClassString];
            }
            return nil;
        }
    }
}
// è¿›å…¥safePerformAction:target:params:å®ç°ï¼Œä¸»è¦æ˜¯é€šè¿‡invocationè¿›è¡Œå‚æ•°ä¼ é€’+æ¶ˆæ¯è½¬å‘
- (id)safePerformAction:(SEL)action target:(NSObject *)target params:(NSDictionary *)params
{
    //è·å–æ–¹æ³•ç­¾å
    NSMethodSignature* methodSig = [target methodSignatureForSelector:action];
    if(methodSig == nil) {
        return nil;
    }
    //è·å–æ–¹æ³•ç­¾åä¸­çš„è¿”å›ç±»å‹ï¼Œç„¶åæ ¹æ®è¿”å›å€¼å®Œæˆå‚æ•°ä¼ é€’
    const char* retType = [methodSig methodReturnType];
    //voidç±»å‹
    if (strcmp(retType, @encode(void)) == 0) {
        ...
    }
    //...çœç•¥å…¶ä»–ç±»å‹çš„åˆ¤æ–­
}

```
::: 
## protocol-class
- å¢åŠ  Protocol Wrapperå±‚ ï¼ˆä¸­é—´ä»¶å…ˆæ³¨å†ŒProtocolå’ŒClasså¯¹åº”å…³ç³»ï¼Œå°†protocolå’Œå¯¹åº”çš„ç±»è¿›è¡Œå­—å…¸åŒ¹é…ï¼‰
- ä¸­é—´ä»¶è¿”å› Protocol å¯¹åº”çš„ Classï¼Œç„¶ååŠ¨æ€åˆ›å»ºå®ä¾‹
- è§£å†³ç¡¬ç¼–ç çš„é—®é¢˜

### Protocol - Classç®€å•ç¤ºä¾‹

::: details
```swift
//å…·ä½“çš„Protocol
//MTMediator.h --- start
@protocol MTDetailViewControllerProtocol <NSObject>

+ (__kindof UIViewController *)detailViewControllerWithUrl:(NSString *)detailUrl;

@end

@interface MTMediator : NSObject
+ (void)registerProtol:(Protocol *)protocol class:(Class)cls;
+ (Class)classForProtocol:(Protocol *)protocol;
@end
//MTMediator.h --- end

//MTMediator.m --- start
+ (void)registerProtol:(Protocol *)protocol class:(Class)cls{
Â  Â  if (protocol && cls) {
Â  Â  Â  Â  [[[self class] mediatorCache] setObject:cls forKey:NSStringFromProtocol(protocol)];
Â  Â  }
}

+ (Class)classForProtocol:(Protocol *)protocol{
    return [[[self class] mediatorCache] objectForKey:NSStringFromProtocol(protocol)];
}
//MTMediator.m --- end

//è¢«è°ƒç”¨
//MTDetailViewController.h --- start
@protocol MTDetailViewControllerProtocol;

@interface MTDetailViewController : UIViewController<MTDetailViewControllerProtocol>
@end
//MTDetailViewController.h --- end

//MTDetailViewController.m --- start
+ (void)load {
    [MTMediator registerProtol: @protocol(MTDetailViewControllerProtocol) class:[self class]];
}

#pragma mark - MTDetailViewControllerProtocol
+ ( __kindof UIViewController *)detailViewControllerWithUrl:(NSString *)detailUrl{
    return [[MTDetailViewController alloc]initWithUrlString:detailUrl];
}
//MTDetailViewController.m --- end

//è°ƒç”¨
Class cls = [MTMediator classForProtocol: @protocol(MTDetailViewControllerProtocol)];
if ([cls respondsToSelector: @selector(detailViewControllerWithUrl:)]) {
Â  Â  Â  Â  [self.navigationController pushViewController:[cls detailViewControllerWithUrl:item.articleUrl] animated:YES];
}

//è¯´æ˜ï¼šè¢«è°ƒç”¨è€…å…ˆåœ¨ä¸­é—´ä»¶æ³¨å†ŒProtocolå’ŒClasså¯¹åº”å…³ç³»ï¼Œå¯¹å¤–åªæš´æ¼Protocol

```
:::

### BeeHive

protocolæ¯”è¾ƒå…¸å‹çš„ä¸‰æ–¹æ¡†æ¶å°±æ˜¯é˜¿é‡Œçš„[BeeHive](https://github.com/alibaba/BeeHive.git)ã€‚BeeHiveå€Ÿé‰´äº†Spring Serviceã€Apache DSOçš„æ¶æ„ç†å¿µï¼Œé‡‡ç”¨AOP+æ‰©å±•Appç”Ÿå‘½å‘¨æœŸAPIå½¢å¼ï¼Œå°†ä¸šåŠ¡åŠŸèƒ½ã€åŸºç¡€åŠŸèƒ½æ¨¡å—ä»¥æ¨¡å—æ–¹å¼ä»¥è§£å†³å¤§å‹åº”ç”¨ä¸­çš„å¤æ‚é—®é¢˜ï¼Œå¹¶è®©æ¨¡å—ä¹‹é—´ä»¥Serviceå½¢å¼è°ƒç”¨ï¼Œå°†å¤æ‚é—®é¢˜åˆ‡åˆ†ï¼Œä»¥AOPæ–¹å¼æ¨¡å—åŒ–æœåŠ¡ã€‚

BeeHive æ ¸å¿ƒæ€æƒ³

1. å„ä¸ªæ¨¡å—é—´è°ƒç”¨ä»ç›´æ¥è°ƒç”¨å¯¹åº”æ¨¡å—ï¼Œå˜æˆè°ƒç”¨Serviceçš„å½¢å¼ï¼Œé¿å…äº†ç›´æ¥ä¾èµ–ã€‚
2. Appç”Ÿå‘½å‘¨æœŸçš„åˆ†å‘ï¼Œå°†è€¦åˆåœ¨AppDelegateä¸­é€»è¾‘æ‹†åˆ†ï¼Œæ¯ä¸ªæ¨¡å—ä»¥å¾®åº”ç”¨çš„å½¢å¼ç‹¬ç«‹å­˜åœ¨ã€‚

ç¤ºä¾‹å¦‚ä¸‹:

::: details
```swift
//******** 1ã€æ³¨å†Œ
[[BeeHive shareInstance] registerService:@protocol(HomeServiceProtocol) service:[BHViewController class]];

//******** 2ã€ä½¿ç”¨
#import "BHService.h"

id< HomeServiceProtocol > homeVc = [[BeeHive shareInstance] createService:@protocol(HomeServiceProtocol)];

```
:::

ä¼˜ç‚¹

1. åˆ©ç”¨æ¥å£è°ƒç”¨ï¼Œå®ç°äº†å‚æ•°ä¼ é€’æ—¶çš„ç±»å‹å®‰å…¨
2. ç›´æ¥ä½¿ç”¨æ¨¡å—çš„protocolæ¥å£ï¼Œæ— éœ€å†é‡å¤å°è£…

ç¼ºç‚¹

1. ç”¨æ¡†æ¶æ¥åˆ›å»ºæ‰€æœ‰å¯¹è±¡ï¼Œåˆ›å»ºæ–¹å¼ä¸åŒï¼Œå³ä¸æ”¯æŒå¤–éƒ¨ä¼ å…¥å‚æ•°
2. ç”¨OC runtimeåˆ›å»ºå¯¹è±¡ï¼Œä¸æ”¯æŒswift
3. åªåšäº†protocol å’Œ class çš„åŒ¹é…ï¼Œä¸æ”¯æŒæ›´å¤æ‚çš„åˆ›å»ºæ–¹å¼ å’Œä¾èµ–æ³¨å…¥
4. æ— æ³•ä¿è¯æ‰€ä½¿ç”¨çš„protocol ä¸€å®šå­˜åœ¨å¯¹åº”çš„æ¨¡å—ï¼Œä¹Ÿæ— æ³•ç›´æ¥åˆ¤æ–­æŸä¸ªprotocolæ˜¯å¦èƒ½ç”¨äºè·å–æ¨¡å—

é™¤äº†BeeHiveï¼Œè¿˜æœ‰Swinject

#### BeeHive æ¨¡å—æ³¨å†Œ

åœ¨BeeHiveä¸»è¦æ˜¯é€šè¿‡BHModuleManageræ¥ç®¡ç†å„ä¸ªæ¨¡å—çš„ã€‚BHModuleManagerä¸­åªä¼šç®¡ç†å·²ç»è¢«æ³¨å†Œè¿‡çš„æ¨¡å—ã€‚
BeeHiveæä¾›äº†ä¸‰ç§ä¸åŒçš„æ³¨å†Œå½¢å¼ï¼Œannotation,é™æ€plistï¼ŒåŠ¨æ€æ³¨å†Œã€‚Moduleã€Serviceä¹‹é—´æ²¡æœ‰å…³è”ï¼Œæ¯ä¸ªä¸šåŠ¡æ¨¡å—å¯ä»¥å•ç‹¬å®ç°Moduleæˆ–è€…Serviceçš„åŠŸèƒ½ã€‚


#### Annotationæ–¹å¼æ³¨å†Œ

è¿™ç§æ–¹å¼ä¸»è¦æ˜¯é€šè¿‡BeeHiveModå®è¿›è¡ŒAnnotationæ ‡è®°

::: tip
```swift
//***** ä½¿ç”¨
BeeHiveMod(ShopModule)

//***** BeeHiveModçš„å®å®šä¹‰
#define BeeHiveMod(name) \
class BeeHive; char * k##name##_mod BeeHiveDATA(BeehiveMods) = ""#name"";

//***** BeeHiveDATAçš„å®å®šä¹‰ 
#define BeeHiveDATA(sectname) __attribute((used, section("__DATA,"#sectname" ")))

//*****  å…¨éƒ¨è½¬æ¢å‡ºæ¥åä¸ºä¸‹é¢çš„æ ¼å¼ ä»¥nameæ˜¯ShopModuleä¸ºä¾‹

char * kShopModule_mod __attribute((used, section("__DATA,""BeehiveMods"" "))) = """ShopModule""";


```
:::

è¿™é‡Œé’ˆå¯¹__attributeéœ€è¦è¯´æ˜ä»¥ä¸‹å‡ ç‚¹

ç¬¬ä¸€ä¸ªå‚æ•°usedï¼šç”¨æ¥ä¿®é¥°å‡½æ•°ï¼Œè¢«usedä¿®é¥°ä»¥åï¼Œæ„å‘³ç€å³ä½¿å‡½æ•°æ²¡æœ‰è¢«å¼•ç”¨ï¼Œåœ¨Releaseä¸‹ä¹Ÿä¸ä¼šè¢«ä¼˜åŒ–ã€‚å¦‚æœä¸åŠ è¿™ä¸ªä¿®é¥°ï¼Œé‚£ä¹ˆReleaseç¯å¢ƒé“¾æ¥å™¨ä¸‹ä¼šå»æ‰æ²¡æœ‰è¢«å¼•ç”¨çš„æ®µã€‚
é€šè¿‡ä½¿ç”¨__attribute__((section("name")))æ¥æŒ‡æ˜å“ªä¸ªæ®µã€‚æ•°æ®åˆ™ç”¨__attribute__((used))æ¥æ ‡è®°ï¼Œé˜²æ­¢é“¾æ¥å™¨ä¼šä¼˜åŒ–åˆ é™¤æœªè¢«ä½¿ç”¨çš„æ®µï¼Œç„¶åå°†æ¨¡å—æ³¨å…¥åˆ°__DATAä¸­

æ­¤æ—¶Moduleå·²ç»è¢«å­˜å‚¨åˆ°Mach-Oæ–‡ä»¶çš„ç‰¹æ®Šæ®µä¸­ï¼Œé‚£ä¹ˆå¦‚ä½•å–å‘¢ï¼Ÿ


è¿›å…¥BHReadConfigurationæ–¹æ³•ï¼Œä¸»è¦æ˜¯é€šè¿‡Mach-Oæ‰¾åˆ°å­˜å‚¨çš„æ•°æ®æ®µï¼Œå–å‡ºæ”¾å…¥æ•°ç»„ä¸­


::: details
```swift
NSArray<NSString *>* BHReadConfiguration(char *sectionName,const struct mach_header *mhp)
{

    NSMutableArray *configs = [NSMutableArray array];
    unsigned long size = 0;
#ifndef __LP64__
    // æ‰¾åˆ°ä¹‹å‰å­˜å‚¨çš„æ•°æ®æ®µ(Moduleæ‰¾BeehiveModsæ®µ å’Œ Serviceæ‰¾BeehiveServicesæ®µ)çš„ä¸€ç‰‡å†…å­˜
    uintptr_t *memory = (uintptr_t*)getsectiondata(mhp, SEG_DATA, sectionName, &size);
#else
    const struct mach_header_64 *mhp64 = (const struct mach_header_64 *)mhp;
    uintptr_t *memory = (uintptr_t*)getsectiondata(mhp64, SEG_DATA, sectionName, &size);
#endif

    unsigned long counter = size/sizeof(void*);
    // æŠŠç‰¹æ®Šæ®µé‡Œé¢çš„æ•°æ®éƒ½è½¬æ¢æˆå­—ç¬¦ä¸²å­˜å…¥æ•°ç»„ä¸­
    for(int idx = 0; idx < counter; ++idx){
        char *string = (char*)memory[idx];
        NSString *str = [NSString stringWithUTF8String:string];
        if(!str)continue;

        BHLog(@"config = %@", str);
        if(str) [configs addObject:str];
    }

    return configs; 
}


```
:::

æ³¨å†Œçš„dyld_callbackå›è°ƒå¦‚ä¸‹

::: details
```swift
static void dyld_callback(const struct mach_header *mhp, intptr_t vmaddr_slide)
{
    NSArray *mods = BHReadConfiguration(BeehiveModSectName, mhp);
    for (NSString *modName in mods) {
        Class cls;
        if (modName) {
            cls = NSClassFromString(modName);

            if (cls) {
                [[BHModuleManager sharedManager] registerDynamicModule:cls];
            }
        }
    }

    //register services
    NSArray<NSString *> *services = BHReadConfiguration(BeehiveServiceSectName,mhp);
    for (NSString *map in services) {
        NSData *jsonData =  [map dataUsingEncoding:NSUTF8StringEncoding];
        NSError *error = nil;
        id json = [NSJSONSerialization JSONObjectWithData:jsonData options:0 error:&error];
        if (!error) {
            if ([json isKindOfClass:[NSDictionary class]] && [json allKeys].count) {

                NSString *protocol = [json allKeys][0];
                NSString *clsName  = [json allValues][0];

                if (protocol && clsName) {
                    [[BHServiceManager sharedManager] registerService:NSProtocolFromString(protocol) implClass:NSClassFromString(clsName)];
                }

            }
        }
    }

}
__attribute__((constructor))
void initProphet() {
    //_dyld_register_func_for_add_imageå‡½æ•°æ˜¯ç”¨æ¥æ³¨å†ŒdyldåŠ è½½é•œåƒæ—¶çš„å›è°ƒå‡½æ•°,åœ¨dyldåŠ è½½é•œåƒæ—¶,ä¼šæ‰§è¡Œæ³¨å†Œè¿‡çš„å›è°ƒå‡½æ•°
    _dyld_register_func_for_add_image(dyld_callback);
}

```
:::

è¯»å–æœ¬åœ°Pilstæ–‡ä»¶
é¦–å…ˆï¼Œéœ€è¦è®¾ç½®å¥½è·¯å¾„

[BHContext shareInstance].moduleConfigName = @"BeeHive.bundle/BeeHive";//å¯é€‰ï¼Œé»˜è®¤ä¸ºBeeHive.bundle/BeeHive.plist

åˆ›å»ºplistæ–‡ä»¶ï¼ŒPlistæ–‡ä»¶çš„æ ¼å¼ä¹Ÿæ˜¯æ•°ç»„ä¸­åŒ…å«å¤šä¸ªå­—å…¸ã€‚å­—å…¸é‡Œé¢æœ‰ä¸¤ä¸ªKeyï¼Œä¸€ä¸ªæ˜¯@"moduleLevel"ï¼Œå¦ä¸€ä¸ªæ˜¯@"moduleClass"ã€‚æ³¨æ„æ ¹çš„æ•°ç»„çš„åå­—å«@â€œmoduleClassesâ€ã€‚

![Screenshot-2023-08-27-at-09](https://cdn.staticaly.com/gh/214070779/picx-images-hosting@master/20230813/Screenshot-2023-08-27-at-09.12.36.57ibc5z4mlw0.webp)

è¿›å…¥loadLocalModulesæ–¹æ³•ï¼Œä¸»è¦æ˜¯ä»Plisté‡Œé¢å–å‡ºæ•°ç»„ï¼Œç„¶åæŠŠæ•°ç»„åŠ å…¥åˆ°BHModuleInfosæ•°ç»„é‡Œé¢ã€‚

::: details
```swift
//åˆå§‹åŒ–contextæ—¶ï¼ŒåŠ è½½Moduleså’ŒServices
-(void)setContext:(BHContext *)context
{
    _context = context;

    static dispatch_once_t onceToken;
    dispatch_once(&onceToken, ^{
        [self loadStaticServices];
        [self loadStaticModules];
    });
}
ğŸ‘‡
//åŠ è½½modules
- (void)loadStaticModules
{
    // è¯»å–æœ¬åœ°plistæ–‡ä»¶é‡Œé¢çš„Moduleï¼Œå¹¶æ³¨å†Œåˆ°BHModuleManagerçš„BHModuleInfosæ•°ç»„ä¸­
    [[BHModuleManager sharedManager] loadLocalModules];
    //æ³¨å†Œæ‰€æœ‰modulesï¼Œåœ¨å†…éƒ¨æ ¹æ®ä¼˜å…ˆçº§è¿›è¡Œæ’åº
    [[BHModuleManager sharedManager] registedAllModules];

}
ğŸ‘‡
- (void)loadLocalModules
{
    //plistæ–‡ä»¶è·¯å¾„
    NSString *plistPath = [[NSBundle mainBundle] pathForResource:[BHContext shareInstance].moduleConfigName ofType:@"plist"];
    //åˆ¤æ–­æ–‡ä»¶æ˜¯å¦å­˜åœ¨
    if (![[NSFileManager defaultManager] fileExistsAtPath:plistPath]) {
        return;
    }
    //è¯»å–æ•´ä¸ªæ–‡ä»¶[@"moduleClasses" : æ•°ç»„]
    NSDictionary *moduleList = [[NSDictionary alloc] initWithContentsOfFile:plistPath];
    //é€šè¿‡moduleClasses keyè¯»å– æ•°ç»„ [[@"moduleClass":"aaa", @"moduleLevel": @"bbb"], [...]]
    NSArray<NSDictionary *> *modulesArray = [moduleList objectForKey:kModuleArrayKey];
    NSMutableDictionary<NSString *, NSNumber *> *moduleInfoByClass = @{}.mutableCopy;
    //éå†æ•°ç»„
    [self.BHModuleInfos enumerateObjectsUsingBlock:^(NSDictionary * _Nonnull obj, NSUInteger idx, BOOL * _Nonnull stop) {
        [moduleInfoByClass setObject:@1 forKey:[obj objectForKey:kModuleInfoNameKey]];
    }];
    [modulesArray enumerateObjectsUsingBlock:^(NSDictionary * _Nonnull obj, NSUInteger idx, BOOL * _Nonnull stop) {
        if (!moduleInfoByClass[[obj objectForKey:kModuleInfoNameKey]]) {
            //å­˜å‚¨åˆ° BHModuleInfos ä¸­
            [self.BHModuleInfos addObject:obj];
        }
    }];
}

```
:::

#### loadæ–¹æ³•æ³¨å†Œ
è¯¥æ–¹æ³•æ³¨å†ŒModuleå°±æ˜¯åœ¨Loadæ–¹æ³•é‡Œé¢æ³¨å†ŒModuleçš„ç±»

::: details
```objectivec
+ (void)load
{
    [BeeHive registerDynamicModule:[self class]];
}

//è¿›å…¥registerDynamicModuleå®ç°
+ (void)registerDynamicModule:(Class)moduleClass
{
    [[BHModuleManager sharedManager] registerDynamicModule:moduleClass];
}
ğŸ‘‡
- (void)registerDynamicModule:(Class)moduleClass
{
    [self registerDynamicModule:moduleClass shouldTriggerInitEvent:NO];
}
ğŸ‘‡
- (void)registerDynamicModule:(Class)moduleClass
       shouldTriggerInitEvent:(BOOL)shouldTriggerInitEvent
{
    [self addModuleFromObject:moduleClass shouldTriggerInitEvent:shouldTriggerInitEvent];
}
// å’ŒAnnotationæ–¹å¼æ³¨å†Œçš„dyld_callbackå›è°ƒä¸€æ ·ï¼Œæœ€ç»ˆä¼šèµ°åˆ°addModuleFromObject:shouldTriggerInitEvent:æ–¹æ³•ä¸­

  - (void)addModuleFromObject:(id)object
       shouldTriggerInitEvent:(BOOL)shouldTriggerInitEvent
  {
      Class class;
      NSString *moduleName = nil;

      if (object) {
          class = object;
          moduleName = NSStringFromClass(class);
      } else {
          return ;
      }

      __block BOOL flag = YES;
      [self.BHModules enumerateObjectsUsingBlock:^(id  _Nonnull obj, NSUInteger idx, BOOL * _Nonnull stop) {
          if ([obj isKindOfClass:class]) {
              flag = NO;
              *stop = YES;
          }
      }];
      if (!flag) {
          return;
      }

      if ([class conformsToProtocol:@protocol(BHModuleProtocol)]) {
          NSMutableDictionary *moduleInfo = [NSMutableDictionary dictionary];

          BOOL responseBasicLevel = [class instancesRespondToSelector:@selector(basicModuleLevel)];

          int levelInt = 1;

          if (responseBasicLevel) {
              levelInt = 0;
          }

          [moduleInfo setObject:@(levelInt) forKey:kModuleInfoLevelKey];
          if (moduleName) {
              [moduleInfo setObject:moduleName forKey:kModuleInfoNameKey];
          }

          [self.BHModuleInfos addObject:moduleInfo];

          id<BHModuleProtocol> moduleInstance = [[class alloc] init];
          [self.BHModules addObject:moduleInstance];
          [moduleInfo setObject:@(YES) forKey:kModuleInfoHasInstantiatedKey];
          [self.BHModules sortUsingComparator:^NSComparisonResult(id<BHModuleProtocol> moduleInstance1, id<BHModuleProtocol> moduleInstance2) {
              NSNumber *module1Level = @(BHModuleNormal);
              NSNumber *module2Level = @(BHModuleNormal);
              if ([moduleInstance1 respondsToSelector:@selector(basicModuleLevel)]) {
                  module1Level = @(BHModuleBasic);
              }
              if ([moduleInstance2 respondsToSelector:@selector(basicModuleLevel)]) {
                  module2Level = @(BHModuleBasic);
              }
              if (module1Level.integerValue != module2Level.integerValue) {
                  return module1Level.integerValue > module2Level.integerValue;
              } else {
                  NSInteger module1Priority = 0;
                  NSInteger module2Priority = 0;
                  if ([moduleInstance1 respondsToSelector:@selector(modulePriority)]) {
                      module1Priority = [moduleInstance1 modulePriority];
                  }
                  if ([moduleInstance2 respondsToSelector:@selector(modulePriority)]) {
                      module2Priority = [moduleInstance2 modulePriority];
                  }
                  return module1Priority < module2Priority;
              }
          }];
          [self registerEventsByModuleInstance:moduleInstance];

          if (shouldTriggerInitEvent) {
              [self handleModuleEvent:BHMSetupEvent forTarget:moduleInstance withSeletorStr:nil andCustomParam:nil];
              [self handleModulesInitEventForTarget:moduleInstance withCustomParam:nil];
              dispatch_async(dispatch_get_main_queue(), ^{
                  [self handleModuleEvent:BHMSplashEvent forTarget:moduleInstance withSeletorStr:nil andCustomParam:nil];
              });
          }
      }
  }

```
:::

loadæ–¹æ³•ï¼Œè¿˜å¯ä»¥ä½¿ç”¨BH_EXPORT_MODULEå®ä»£æ›¿

::: tip
```
#define BH_EXPORT_MODULE(isAsync) \
+ (void)load { [BeeHive registerDynamicModule:[self class]]; } \
-(BOOL)async { return [[NSString stringWithUTF8String:#isAsync] boolValue];}
```
:::

BH_EXPORT_MODULEå®é‡Œé¢å¯ä»¥ä¼ å…¥ä¸€ä¸ªå‚æ•°ï¼Œä»£è¡¨æ˜¯å¦å¼‚æ­¥åŠ è½½Moduleæ¨¡å—ï¼Œå¦‚æœæ˜¯YESå°±æ˜¯å¼‚æ­¥åŠ è½½ï¼Œå¦‚æœæ˜¯NOå°±æ˜¯åŒæ­¥åŠ è½½ã€‚


#### BeeHive Protocolæ³¨å†Œ
åœ¨BeeHiveä¸­æ˜¯é€šè¿‡BHServiceManageræ¥ç®¡ç†å„ä¸ªProtocolçš„ã€‚BHServiceManagerä¸­åªä¼šç®¡ç†å·²ç»è¢«æ³¨å†Œè¿‡çš„Protocolã€‚

æ³¨å†ŒProtocolçš„æ–¹å¼æ€»å…±æœ‰ä¸‰ç§ï¼Œå’Œæ³¨å†ŒModuleæ˜¯ä¸€æ ·ä¸€ä¸€å¯¹åº”çš„

Annotationæ–¹å¼æ³¨å†Œ

::: tip
```
//****** 1ã€é€šè¿‡BeeHiveServiceå®è¿›è¡ŒAnnotationæ ‡è®°
BeeHiveService(HomeServiceProtocol,BHViewController)

//****** 2ã€å®å®šä¹‰
#define BeeHiveService(servicename,impl) \
class BeeHive; char * k##servicename##_service BeeHiveDATA(BeehiveServices) = "{ ""#servicename"" : ""#impl""}";

//****** 3ã€è½¬æ¢åçš„æ ¼å¼ï¼Œä¹Ÿæ˜¯å°†å…¶å­˜å‚¨åˆ°ç‰¹æ®Šçš„æ®µ
char * kHomeServiceProtocol_service __attribute((used, section("__DATA,""BeehiveServices"" "))) = "{ """HomeServiceProtocol""" : """BHViewController"""}";

```
:::

#### è¯»å–æœ¬åœ°plistæ–‡ä»¶
é¦–å…ˆåŒModuleä¸€æ ·ï¼Œéœ€è¦å…ˆè®¾ç½®å¥½è·¯å¾„

::: tip
[BHContext shareInstance].serviceConfigName = @"BeeHive.bundle/BHService";
:::

è®¾ç½®plistæ–‡ä»¶

![Screenshot-2023-08-27-at-09](https://cdn.staticaly.com/gh/214070779/picx-images-hosting@master/20230813/Screenshot-2023-08-27-at-09.22.41.1q1a19dazirk.webp)

åŒæ ·ä¹Ÿæ˜¯åœ¨setContextæ—¶æ³¨å†Œservices

::: details
```
//åŠ è½½services
-(void)loadStaticServices
{
    [BHServiceManager sharedManager].enableException = self.enableException;

    [[BHServiceManager sharedManager] registerLocalServices];

}
ğŸ‘‡
- (void)registerLocalServices
{
    NSString *serviceConfigName = [BHContext shareInstance].serviceConfigName;
    //è·å–plistæ–‡ä»¶è·¯å¾„
    NSString *plistPath = [[NSBundle mainBundle] pathForResource:serviceConfigName ofType:@"plist"];
    if (!plistPath) {
        return;
    }

    NSArray *serviceList = [[NSArray alloc] initWithContentsOfFile:plistPath];

    [self.lock lock];
    //éå†å¹¶å­˜å‚¨åˆ°allServicesDictä¸­
    for (NSDictionary *dict in serviceList) {
        NSString *protocolKey = [dict objectForKey:@"service"];
        NSString *protocolImplClass = [dict objectForKey:@"impl"];
        if (protocolKey.length > 0 && protocolImplClass.length > 0) {
            [self.allServicesDict addEntriesFromDictionary:@{protocolKey:protocolImplClass}];
        }
    }
    [self.lock unlock];
}

```
::: 

#### loadæ–¹æ³•æ³¨å†Œ
åœ¨Loadæ–¹æ³•é‡Œé¢æ³¨å†ŒProtocolåè®®ï¼Œä¸»è¦æ˜¯è°ƒç”¨BeeHiveé‡Œé¢çš„registerService:service:å®Œæˆprotocolçš„æ³¨å†Œ
```
+ (void)load
{
   [[BeeHive shareInstance] registerService:@protocol(UserTrackServiceProtocol) service:[BHUserTrackViewController class]];
}
ğŸ‘‡
- (void)registerService:(Protocol *)proto service:(Class) serviceClass
{
    [[BHServiceManager sharedManager] registerService:proto implClass:serviceClass];
}
```
åˆ°æ­¤ï¼Œä¸‰ç§æ–¹å¼æ³¨å†Œå°±å®Œæˆäº†

#### Protocolçš„è·å–
Protocolä¸Moduleçš„åŒºåˆ«åœ¨äºï¼ŒProtocolæ¯”Moduleå¤šäº†ä¸€ä¸ªæ–¹æ³•ï¼Œå¯ä»¥è¿”å›Protocolå®ä¾‹å¯¹è±¡

::: details
```
- (id)createService:(Protocol *)proto;
{
    return [[BHServiceManager sharedManager] createService:proto];
}
ğŸ‘‡
- (id)createService:(Protocol *)service
{
    return [self createService:service withServiceName:nil];
}
ğŸ‘‡
- (id)createService:(Protocol *)service withServiceName:(NSString *)serviceName {
    return [self createService:service withServiceName:serviceName shouldCache:YES];
}
ğŸ‘‡
- (id)createService:(Protocol *)service withServiceName:(NSString *)serviceName shouldCache:(BOOL)shouldCache {
    if (!serviceName.length) {
        serviceName = NSStringFromProtocol(service);
    }
    id implInstance = nil;
    //åˆ¤æ–­protocolæ˜¯å¦å·²ç»æ³¨å†Œè¿‡
    if (![self checkValidService:service]) {
        if (self.enableException) {
            @throw [NSException exceptionWithName:NSInternalInconsistencyException reason:[NSString stringWithFormat:@"%@ protocol does not been registed", NSStringFromProtocol(service)] userInfo:nil];
        }
        
    }
    
    NSString *serviceStr = serviceName;
    //å¦‚æœæœ‰ç¼“å­˜ï¼Œåˆ™ç›´æ¥ä»ç¼“å­˜ä¸­è·å–
    if (shouldCache) {
        id protocolImpl = [[BHContext shareInstance] getServiceInstanceFromServiceName:serviceStr];
        if (protocolImpl) {
            return protocolImpl;
        }
    }
    //è·å–ç±»åï¼Œç„¶åå“åº”ä¸‹å±‚çš„æ–¹æ³•
    Class implClass = [self serviceImplClass:service];
    if ([[implClass class] respondsToSelector:@selector(singleton)]) {
        if ([[implClass class] singleton]) {
            if ([[implClass class] respondsToSelector:@selector(shareInstance)])
                //åˆ›å»ºå•ä¾‹å¯¹è±¡
                implInstance = [[implClass class] shareInstance];
            else
                //åˆ›å»ºå®ä¾‹å¯¹è±¡
                implInstance = [[implClass alloc] init];
            if (shouldCache) {
                //ç¼“å­˜
                [[BHContext shareInstance] addServiceWithImplInstance:implInstance serviceName:serviceStr];
                return implInstance;
            } else {
                return implInstance;
            }
        }
    }
    return [[implClass alloc] init];
}

```
:::

createServiceä¼šå…ˆæ£€æŸ¥Protocolåè®®æ˜¯å¦æ˜¯æ³¨å†Œè¿‡çš„ã€‚ç„¶åæ¥ç€å–å‡ºå­—å…¸é‡Œé¢å¯¹åº”çš„Classï¼Œå¦‚æœå®ç°äº†shareInstanceæ–¹æ³•ï¼Œé‚£ä¹ˆå°±åˆ›å»ºä¸€ä¸ªå•ä¾‹å¯¹è±¡ï¼Œå¦‚æœæ²¡æœ‰ï¼Œé‚£ä¹ˆå°±åˆ›å»ºä¸€ä¸ªå®ä¾‹å¯¹è±¡ã€‚å¦‚æœè¿˜å®ç°äº†singletonï¼Œå°±èƒ½è¿›ä¸€æ­¥çš„æŠŠimplInstanceå’ŒserviceStrå¯¹åº”çš„åŠ åˆ°BHContextçš„servicesByNameå­—å…¸é‡Œé¢ç¼“å­˜èµ·æ¥ã€‚è¿™æ ·å°±å¯ä»¥éšç€ä¸Šä¸‹æ–‡ä¼ é€’äº†

è¿›å…¥serviceImplClasså®ç°ï¼Œä»è¿™é‡Œå¯ä»¥çœ‹å‡º protocolå’Œç±»æ˜¯é€šè¿‡å­—å…¸ç»‘å®šçš„ï¼Œprotocolä½œä¸ºkeyï¼ŒserviceImpï¼ˆç±»çš„åå­—ï¼‰ä½œä¸ºvalue

::: details
```
- (Class)serviceImplClass:(Protocol *)service
{
    //é€šè¿‡å­—å…¸å°† åè®® å’Œ ç±» ç»‘å®šï¼Œå…¶ä¸­åè®®ä½œä¸ºkeyï¼ŒserviceImpï¼ˆç±»çš„åå­—ï¼‰ä½œä¸ºvalue
    NSString *serviceImpl = [[self servicesDict] objectForKey:NSStringFromProtocol(service)];
    if (serviceImpl.length > 0) {
        return NSClassFromString(serviceImpl);
    }
    return nil;
}
```
:::
#### Module & Protocol

è¿™é‡Œç®€å•æ€»ç»“ä¸‹ï¼š

- å¯¹äºModuleï¼šæ•°ç»„å­˜å‚¨

- å¯¹äºProtocolï¼šé€šè¿‡å­—å…¸å°†protocolä¸ç±»è¿›è¡Œç»‘å®šï¼Œkeyä¸ºprotocolï¼Œvalueä¸º serviceImpå³ç±»å

BeeHiveè¾…åŠ©ç±»

- BHContextç±»ï¼šæ˜¯ä¸€ä¸ªå•ä¾‹ï¼Œå…¶å†…éƒ¨æœ‰ä¸¤ä¸ªNSMutableDictionaryçš„å±æ€§ï¼Œåˆ†åˆ«æ˜¯modulesByName å’Œ servicesByNameã€‚è¿™ä¸ªç±»ä¸»è¦ç”¨æ¥ä¿å­˜ä¸Šä¸‹æ–‡ä¿¡æ¯çš„ã€‚ä¾‹å¦‚åœ¨application:didFinishLaunchingWithOptions:çš„æ—¶å€™ï¼Œå°±å¯ä»¥åˆå§‹åŒ–å¤§é‡çš„ä¸Šä¸‹æ–‡ä¿¡æ¯

```
//ä¿å­˜ä¿¡æ¯
[BHContext shareInstance].application = application;
[BHContext shareInstance].launchOptions = launchOptions;
[BHContext shareInstance].moduleConfigName = @"BeeHive.bundle/BeeHive";//å¯é€‰ï¼Œé»˜è®¤ä¸ºBeeHive.bundle/BeeHive.plist
[BHContext shareInstance].serviceConfigName = @"BeeHive.bundle/BHService";
```

- BHConfigç±»ï¼šæ˜¯ä¸€ä¸ªå•ä¾‹ï¼Œå…¶å†…éƒ¨æœ‰ä¸€ä¸ªNSMutableDictionaryç±»å‹çš„configå±æ€§ï¼Œè¯¥å±æ€§ç»´æŠ¤äº†ä¸€äº›åŠ¨æ€çš„ç¯å¢ƒå˜é‡ï¼Œä½œä¸ºBHContextçš„è¡¥å……å­˜åœ¨


- BHTimeProfilerç±»ï¼šç”¨æ¥è¿›è¡Œè®¡ç®—æ—¶é—´æ€§èƒ½æ–¹é¢çš„Profiler


- BHWatchDogç±»ï¼šç”¨æ¥å¼€ä¸€ä¸ªçº¿ç¨‹ï¼Œç›‘å¬ä¸»çº¿ç¨‹æ˜¯å¦å µå¡



## ç»„ä»¶åŒ–æ¶æ„å®è·µè§„èŒƒå’ŒåŸåˆ™
åŸºäºä»¥ä¸Šè¿™äº›ç»„ä»¶åŒ–æ¶æ„çš„é—®é¢˜ï¼Œéœ€è¦ä¸€äº›ç»„ä»¶åŒ–æ¶æ„ç›¸å…³çš„è§„èŒƒå’ŒåŸåˆ™å¸®åŠ©æˆ‘ä»¬åšå¥½ç»„ä»¶åŒ–æ¶æ„ï¼Œåé¢ä¸»è¦ä¼šå›´ç»•ä»¥ä¸‹ä¸‰ç‚¹è¿›è¡Œä»‹ç»ï¼š

- ç»„ä»¶æ‹†åˆ†åŸåˆ™ - æ‹†åˆ†æ€æƒ³å’Œæœ€ä½³å®è·µæŒ‡å¯¼ç»„ä»¶æ‹†åˆ†
- ç»„ä»¶é—´ä¾èµ– - ä¼˜åŒ–ç»„ä»¶é—´ä¾èµ–å…³ç³»è·¨ç»„ä»¶è°ƒç”¨/é€šä¿¡æ–¹å¼çš„é€‰æ‹©
- è´¨é‡ä¿éšœ - é¿å…åœ¨æŒç»­çš„å·¥ç¨‹æ¼”åŒ–è¿‡ç¨‹ä¸­å·¥ç¨‹è´¨é‡é€æ¸åŠ£åŒ–ã€‚ä¸»è¦åŒ…å«å®‰å…¨å¡å£å’ŒCIæ£€æŸ¥

æ¥ä¸‹æ¥ä»¥ä¸€ä¸ªå…¸å‹çš„ç”µå•†APPæ¶æ„æ¡ˆä¾‹æ¥ä»‹ç»ä¸€ä¸ªç»„ä»¶åŒ–å·¥ç¨‹ã€‚è¿™ä¸ªæ¡ˆä¾‹æ¶æ„å…·å¤‡ä¹‹å‰æ‰€è¯´ç°æœ‰ä¸­å¤§å‹APPæ¶æ„çš„ä¸€äº›ç‰¹ç‚¹ï¼Œå¤šç»„ä»¶ã€å¤šæŠ€æœ¯æ ˆã€ä¸šåŠ¡é—´éœ€è¦è§£è€¦ã€å¤ç”¨åº•å±‚åŸºç¡€ç»„ä»¶ã€‚åŸºäºè¿™ä¸ªæ¡ˆä¾‹æ¥ä»‹ç»ä¸Šé¢çš„ä¸‰ç‚¹åŸåˆ™ã€‚
![Screenshot-2023-08-27-at-20](https://cdn.staticaly.com/gh/214070779/picx-images-hosting@master/20230813/Screenshot-2023-08-27-at-20.00.38.6idzkez2x900.webp)


###  ç»„å»ºæ‹†åˆ†åŸåˆ™

![Screenshot-2023-08-27-at-20](https://cdn.staticaly.com/gh/214070779/picx-images-hosting@master/20230813/Screenshot-2023-08-27-at-20.01.38.7oi4nqecunc.webp)

ç»„ä»¶æ‹†åˆ†æœ€é‡è¦æ˜¯å¸®æˆ‘ä»¬æ¢³ç†å‡ºç»„ä»¶èŒè´£ä»¥åŠç»„ä»¶èŒè´£çš„è¾¹ç•Œã€‚ç»„ä»¶åˆ’åˆ†ä¹Ÿä¼šä½¿ç”¨å¾ˆå¤šé€šç”¨çš„è®¾è®¡åŸåˆ™å’Œæ¶æ„æ€æƒ³ã€‚

#### ä½¿ç”¨åˆ†å±‚æ€æƒ³æ‹†åˆ†

é€šå¸¸æˆ‘ä»¬å¯ä»¥é¦–å…ˆä½¿ç”¨åˆ†å±‚æ¶æ„çš„æ€æƒ³å°†æ‰€æœ‰ç»„ä»¶çºµå‘æ‹†åˆ†ä¸ºå¤šå±‚ç»„ä»¶ï¼Œä¸Šé¢å±‚çº§çš„ç»„ä»¶åªèƒ½ä¾èµ–ä¸‹é¢å±‚çº§çš„ç»„ä»¶ã€‚ä¸€èˆ¬è‡³å°‘å¯ä»¥åˆ’åˆ†ä¸ºå››å±‚ç»„ä»¶ï¼š

- åŸºç¡€å±‚ - æä¾›æ ¸å¿ƒçš„ä¸ä¸Šå±‚ä¸šåŠ¡æ— å…³çš„åŸºç¡€èƒ½åŠ›ã€‚å¯ä»¥è¢«ä¸Šå±‚ç»„ä»¶ç›´æ¥ä¾èµ–ä½¿ç”¨ã€‚
- ä¸šåŠ¡å…¬å…±å±‚ - ä¸»è¦åŒ…å«é¡µé¢è·¯ç”±ã€å…¬å…±UIç»„ä»¶ã€è·¨ç»„ä»¶é€šä¿¡ä»¥åŠæœåŠ¡æ¥å£ï¼Œå¯è¢«ä¸Šå±‚ç»„ä»¶ç›´æ¥ä¾èµ–ä½¿ç”¨ã€‚
- ä¸šåŠ¡å®ç°å±‚ - ä¸šåŠ¡æ ¸å¿ƒå®ç°å±‚ï¼ŒåŒ…å«åŸç”Ÿé¡µé¢ã€è·¨å¹³å°å®¹å™¨ã€ä¸šåŠ¡æœåŠ¡å®ç°ã€‚ç»„ä»¶é—´ä¸èƒ½ç›´æ¥ä¾èµ–ï¼Œåªèƒ½é€šè¿‡è°ƒç”¨é¡µé¢è·¯ç”±æˆ–è·¨ç»„ä»¶é€šä¿¡ç»„ä»¶è¿›è¡Œä½¿ç”¨ã€‚
- APPå®¿ä¸»å±‚ - ä¸»è¦åŒ…å«APPä¸»å·¥ç¨‹ã€å¯åŠ¨æµç¨‹ã€é¡µé¢è·¯ç”±æ³¨å†Œã€æœåŠ¡æ³¨å†Œã€SDKå‚æ•°åˆå§‹åŒ–ç­‰ç»„ä»¶ï¼Œç”¨äºæ„å»ºæ‰“åŒ…ç”Ÿæˆç›¸åº”çš„APPã€‚

åˆ’åˆ†å±‚çº§å¯ä»¥å¾ˆå¥½çš„æŒ‡å¯¼æˆ‘ä»¬è¿›è¡Œç»„ä»¶æ‹†åˆ†ã€‚åœ¨æ‹†åˆ†ç»„ä»¶æ—¶æˆ‘ä»¬éœ€è¦å…ˆè¯†åˆ«å®ƒåº”è¯¥åœ¨å“ªä¸€å±‚ï¼Œå®ƒåº”è¯¥ä»¥å“ªç§è°ƒç”¨æ–¹å¼è¢«å…¶ä»–ç»„ä»¶ä½¿ç”¨ï¼Œæ–°æ·»åŠ çš„åŠŸèƒ½æ˜¯å¦ä¼šäº§ç”Ÿåå‘ä¾èµ–ï¼Œå¸®åŠ©æˆ‘ä»¬è§„èŒƒç»„ä»¶é—´çš„ä¾èµ–å…³ç³»ã€‚åŒæ—¶æŒ‰å±‚çº§æ‹†åˆ†ç»„ä»¶ä¹Ÿæœ‰åˆ©äºåº•å±‚åŸºç¡€ç»„ä»¶çš„å¤ç”¨ã€‚
ä»¥ä¸‹åœºæ™¯ä½¿ç”¨åˆ†å±‚æ€æƒ³å°±å¾ˆå®¹æ˜“è¯†åˆ«ï¼š

**åŸºç¡€ç»„ä»¶ä¾èµ–ä¸šåŠ¡ç»„ä»¶**

ä¾‹å­ï¼šAPPå†…ä¸šåŠ¡å‘èµ·ç½‘ç»œè¯·æ±‚é€šå¸¸éœ€è¦æºå¸¦å…¬å…±å‚æ•°/Cookieã€‚

- æ²¡æœ‰ç»„ä»¶åˆ†å±‚çº¦æŸ - ç½‘ç»œåº“å¯èƒ½ä¼šä¾èµ–ç™»å½•æœåŠ¡è·å–ç”¨æˆ·ä¿¡æ¯ã€ä¾èµ–å®šä½æœåŠ¡è·å–ç»çº¬åº¦ï¼Œå¼•å…¥å¤§é‡çš„ä¾èµ–å˜æˆä¸šåŠ¡ç»„ä»¶ã€‚

- æœ‰ç»„ä»¶åˆ†å±‚çº¦æŸ - ç½‘ç»œåº“ä½œä¸ºä¸€ä¸ªåŸºç¡€ç»„ä»¶ï¼Œå®ƒä¸éœ€è¦å…³æ³¨ä¸Šå±‚ä¸šåŠ¡éœ€è¦æºå¸¦å“ªäº›å…¬å…±ä¸šåŠ¡å‚æ•°ï¼ŒåŒæ—¶ç™»å½•/å®šä½æœåŠ¡ç»„ä»¶åœ¨ç½‘ç»œåº“ä¸Šå±‚ä¸èƒ½è¢«åå‘ä¾èµ–ã€‚è¿™æ—¶å€™ä¼šè€ƒè™‘å•ç‹¬åˆ›å»ºä¸€ä¸ªå…¬å…±å‚æ•°ç®¡ç†ç±»ï¼Œåœ¨APPè¿è¡Œæ—¶ç›‘å¬å„ç§çŠ¶æ€çš„å˜æ›´å¹¶è°ƒç”¨ç½‘ç»œåº“æ›´æ–°å…¬å…±å‚æ•°/Cookieã€‚


**ä¸šåŠ¡ç»„ä»¶é—´ä¾èµ–æ–¹å‘æ˜¯å¦æ­£ç¡®**

ç™»å½•çŠ¶æ€åˆ‡æ¢ç»å¸¸ä¼šæ¶‰åŠåˆ°å¾ˆå¤šä¸šåŠ¡é€»è¾‘çš„è§¦å‘ï¼Œä¾‹å¦‚æ¸…ç©ºæœ¬åœ°ç”¨æˆ·ç¼“å­˜ã€åœ°å€ç¼“å­˜ã€æ¸…ç©ºè´­ç‰©è½¦æ•°æ®ã€UIçŠ¶æ€å˜æ›´ã€‚

- æ²¡æœ‰ç»„ä»¶åˆ†å±‚çº¦æŸ - å¯èƒ½ä¼šåœ¨ç™»å½•æœåŠ¡å†…å½“ç™»å½•çŠ¶æ€åˆ‡æ¢æ—¶è°ƒç”¨å¤šä¸ªä¸šåŠ¡é€»è¾‘çš„è§¦å‘ï¼Œå¯¼è‡´ç™»å½•æœåŠ¡å¼•å…¥å¤šä¸ªä¸šåŠ¡ç»„ä»¶ä¾èµ–ã€‚
- æœ‰ç»„ä»¶åˆ†å±‚çº¦æŸ - ç™»å½•ç»„ä»¶åªéœ€è¦åœ¨ç™»å½•çŠ¶æ€åˆ‡æ¢æ—¶å‘å‡ºé€šçŸ¥ï¼Œæ— éœ€çŸ¥é“ç™»å½•çŠ¶æ€åˆ‡æ¢ä¼šå½±å“å“ªäº›ä¸šåŠ¡ã€‚ä¸šåŠ¡é€»è¾‘åº”è¯¥ç›‘å¬ç™»å½•çŠ¶æ€çš„å˜æ›´ã€‚

**è¯†åˆ«åŸºç¡€ç»„ä»¶è¿˜æ˜¯ä¸šåŠ¡ç»„ä»¶**

è™½ç„¶å¾ˆå¤šåœºæ™¯ä¸‹æˆ‘ä»¬å¾ˆå®¹æ˜“èƒ½è¯†åˆ«å¤„ç†å‡ºæ¥ä¸€ä¸ªåŠŸèƒ½åº”è¯¥å½’å±äºåŸºç¡€ç»„ä»¶è¿˜æ˜¯ä¸šåŠ¡ç»„ä»¶ï¼Œä¾‹å¦‚ä¸€ä¸ªUIæ§ä»¶æ˜¯åŸºç¡€ç»„ä»¶è¿˜æ˜¯ä¸šåŠ¡ç»„ä»¶ã€‚ä½†æ˜¯å¾ˆå¤šæ—¶å€™è¾¹ç•Œåˆéå¸¸çš„æ¨¡ç³Šï¼Œä¾‹å¦‚ä¸€ä¸ªæ·»åŠ è´­ç‰©è½¦æŒ‰é”®åº”è¯¥æ˜¯ä¸€ä¸ªåŸºç¡€ç»„ä»¶è¿˜æ˜¯ä¸šåŠ¡ç»„ä»¶å‘¢ã€‚

- åŸºç¡€ç»„ä»¶ - å¦‚æœä¸éœ€è¦ä¾èµ–ä¸šåŠ¡å…¬å…±å±‚é‚£åº”å½“åˆ’åˆ†ä¸ºä¸€ä¸ªåŸºç¡€ç»„ä»¶ã€‚
- ä¸šåŠ¡ç»„ä»¶ - ä¾èµ–äº†ä¸šåŠ¡å…¬å…±å±‚æˆ–è€…ç½‘ç»œåº“ï¼Œé‚£å°±åº”è¯¥åˆ’åˆ†ä¸ºä¸€ä¸ªä¸šåŠ¡ç»„ä»¶ã€‚

åˆ†å±‚æ€æƒ³å¯ä»¥å¾ˆå¥½çš„å¸®åŠ©æˆ‘ä»¬ç®¡ç†ç»„ä»¶é—´çš„ä¾èµ–å…³ç³»ï¼Œå¹¶ä¸”æ˜ç¡®æ¯ä¸ªç»„ä»¶çš„èŒè´£è¾¹ç•Œã€‚


### åŸºç¡€/ä¸šåŠ¡ç»„ä»¶æ‹†åˆ†åŸåˆ™

åˆ’åˆ†åŸºç¡€/ä¸šåŠ¡ç»„ä»¶ä¸»è¦æ˜¯ä¸ºäº†å¼ºåˆ¶çº¦æŸç»„ä»¶é—´çš„ä¾èµ–å…³ç³»ã€‚ä»¥ä¸Šé¢çš„ç»„ä»¶åˆ†å±‚æ¶æ„ä¸ºä¾‹ï¼š
- åŸºç¡€ç»„ä»¶ - åŸºç¡€ç»„ä»¶å¯è¢«ç›´æ¥ä¾èµ–ä½¿ç”¨ï¼Œä½¿ç”¨æ–¹è°ƒç”¨åŸºç¡€ç»„ä»¶å¯¹å¤–æš´éœ²APIç›´æ¥ä½¿ç”¨ã€‚åŸºç¡€å±‚ã€ä¸šåŠ¡å…¬å…±å±‚éƒ½ä¸ºåŸºç¡€ç»„ä»¶ã€‚
- ä¸šåŠ¡ç»„ä»¶ - ä¸šåŠ¡ç»„ä»¶ä¸å¯è¢«ç›´æ¥ä¾èµ–ä½¿ç”¨ï¼Œåªèƒ½é€šè¿‡é—´æ¥é€šä¿¡æ–¹å¼è¿›è¡Œä½¿ç”¨ã€‚APPå®¿ä¸»å±‚å’Œä¸šåŠ¡å®ç°å±‚éƒ½ä¸ºä¸šåŠ¡ç»„ä»¶ã€‚
æç¤ºï¼šè¿™é‡Œçš„ä¸šåŠ¡ç»„ä»¶å¹¶ä¸åŒ…å«ä¸šåŠ¡UIç»„ä»¶ã€‚


####  åŸºç¡€ç»„ä»¶æ‹†åˆ†

åŸºç¡€ç»„ä»¶é€šå¸¸æ ¹æ®èŒè´£å•ä¸€åŸåˆ™è¿›è¡Œæ‹†åˆ†æ¯”è¾ƒå®¹æ˜“æ‹†åˆ†ï¼Œä½†æ˜¯ä¼šæœ‰ä¸€äº›æ‹†åˆ†åœºæ™¯éœ€è¦è€ƒè™‘ï¼š
**ä½¿ç”¨æ’ä»¶ç»„ä»¶æ‹†åˆ†åŸºç¡€ç»„ä»¶æ‰©å±•èƒ½åŠ›**
å°†æ ¸å¿ƒåŸºç¡€èƒ½åŠ›å’Œæ‰©å±•èƒ½åŠ›æ‹†åˆ†åˆ°ä¸åŒçš„ç»„ä»¶ã€‚ä»¥ç½‘ç»œåº“ä¸ºä¾‹ï¼Œé™¤äº†æä¾›æœ€æ ¸å¿ƒçš„æ¥å£è¯·æ±‚èƒ½åŠ›ï¼ŒåŒæ—¶å¯èƒ½è¿˜åŒ…å«ä¸€äº›-æ‰©å±•èƒ½åŠ›ä¾‹å¦‚HTTPDNSã€ç½‘ç»œæ€§èƒ½æ£€æµ‹ã€å¼±ç½‘ä¼˜åŒ–ç­‰èƒ½åŠ›ã€‚ä½†è¿™äº›æ‰©å±•èƒ½åŠ›æ”¾åœ¨ç½‘ç»œåº“ç»„ä»¶å†…éƒ¨å¯èƒ½ä¼šå¯¼è‡´ä»¥ä¸‹é—®é¢˜ï¼š
- æ‰©å±•èƒ½åŠ›ä¼šä½¿ç»„ä»¶è‡ªèº«ä»£ç å˜å¾—æ›´åŠ å¤æ‚ã€‚
- ä½¿ç”¨æ–¹ä¸ä¸€å®šä¼šä½¿ç”¨æ‰€æœ‰è¿™äº›æ‰©å±•èƒ½åŠ›è¿åäº†æœ€å°ä¾èµ–åŸåˆ™ã€‚å¸¦æ¥æ›´å¤šçš„åŒ…ä½“ç§¯ï¼Œå¼•å…¥æ›´å¤šçš„ç»„ä»¶ä¾èµ–ï¼Œå¢åŠ æ¨¡å—é—´çš„è€¦åˆåº¦ã€‚
- ç›¸å…³çš„æ‰©å±•èƒ½åŠ›ä¸æ”¯æŒçµæ´»çš„æ›¿æ¢/æ’æ‹”ã€‚
æ‰€ä»¥è¿™ç§åœºæ™¯æˆ‘ä»¬å¯ä»¥è€ƒè™‘æ ¹æ®å®é™…æƒ…å†µå°†æ‰©å±•èƒ½åŠ›æ‹†åˆ†åˆ°ç›¸åº”çš„æ’ä»¶ç»„ä»¶ï¼Œä½¿ç”¨æ–¹éœ€è¦æ—¶å†ä¾èµ–å¼•å…¥å¯¹åº”æ’ä»¶ç»„ä»¶ã€‚

#### ä¸šåŠ¡ç»„ä»¶æ‹†åˆ†

ä¸šåŠ¡é¡µé¢æ‹†åˆ†æ–¹å¼

é’ˆå¯¹ä¸šåŠ¡é¡µé¢å¯ä»¥ä½¿ç”¨æŠ€æœ¯æ ˆã€ä¸šåŠ¡åŸŸã€é¡µé¢ç²’åº¦ä¸‰ç§æ–¹å¼è¿›è¡Œæ›´ç»†ç²’åº¦çš„åˆ’åˆ†ï¼Œé€šå¸¸è‡³å°‘è¦æ‹†åˆ†åˆ°æŠ€æœ¯æ ˆã€ä¸šåŠ¡åŸŸè¿™ä¸€å±‚çº§ï¼Œé¡µé¢ç²’åº¦æ‹†åˆ†æ ¹æ®å…·ä½“é¡µé¢å¤æ‚åº¦å’Œå¤ç”¨è¯‰æ±‚ã€‚

- åŸºäºæŠ€æœ¯æ ˆè¿›è¡Œæ‹†åˆ† - ä¸åŒçš„æŠ€æœ¯æ ˆéœ€è¦æ‹†åˆ†åˆ°ä¸åŒçš„ç»„ä»¶è¿›è¡Œç®¡ç†ã€‚
- åŸºäºä¸šåŠ¡åŸŸè¿›è¡Œæ‹†åˆ† - å°†åŒä¸€ä¸ªä¸šåŠ¡åŸŸçš„æ‰€æœ‰é¡µé¢æ‹†åˆ†ä¸€ä¸ªç»„ä»¶ï¼Œé¿å…ä¸åŒä¸šåŠ¡åŸŸä¹‹é—´å½¢æˆå¼ºè€¦åˆä¾èµ–å…³ç³»ï¼ŒåŒä¸€ä¸ªä¸šåŠ¡åŸŸé€šå¸¸ä¼šæœ‰æ›´å¤šå¤ç”¨å’Œé€šä¿¡çš„åœºæ™¯ä¹Ÿæ–¹ä¾¿å¼€å‘ã€‚ä¾‹å¦‚è®¢å•è¯¦æƒ…å’Œè®¢å•åˆ—è¡¨å¯æ”¾ç½®åœ¨ä¸€èµ·ç®¡ç†ã€‚
- åŸºäºé¡µé¢ç²’åº¦è¿›è¡Œæ‹†åˆ† - å•ä¸ªé¡µé¢å¤æ‚åº¦è¿‡é«˜æˆ–éœ€è¦è¢«å•ç‹¬å¤ç”¨æ—¶éœ€è¦æ‹†åˆ†åˆ°ä¸€ä¸ªå•ä¸ªç»„ä»¶ç®¡ç†ã€‚

æç¤ºï¼šæ”¾ç½®åœ¨å•ä¸€ç»„ä»¶å†…çš„å¤šä¸ªé¡µé¢ä¹‹é—´ä¹Ÿåº”é€‚å½“é™ä½è€¦åˆç¨‹åº¦ã€‚


#### ç¬¬ä¸‰æ–¹åº“

**ç¬¬ä¸‰æ–¹åº“åº”æ‹†åˆ†å•ç‹¬ç»„ä»¶ç®¡ç†**
ç¬¬ä¸‰æ–¹åº“åº”ä½¿ç”¨ç‹¬ç«‹çš„ç»„ä»¶è¿›è¡Œç®¡ç†ï¼Œä¸€æ–¹é¢æœ‰åˆ©äºç»„ä»¶å¤ç”¨åŒæ—¶é¿å…å¤šä¸ªé‡å¤ç¬¬ä¸‰æ–¹åº“å¯¼è‡´ç¬¦å·å†²çªï¼Œå¦ä¸€æ–¹é¢æœ‰åˆ©äºåç»­å‡çº§ç»´æŠ¤ã€‚